@using PeopleOps.Web.Contracts
@using PeopleOps.Web.Features.Acknowledgements
@inject ISender Sender
@code {
    
    [Parameter]
    public long AcknowledgementId { get; set; }
    [Parameter]
    public int ProfileId { get; set; }
    [Parameter]
    public AcknowledgementResponse Acknowledgement { get; set; }
    
    private bool IsLiked { get; set; }
    
    private long AcknowledgementLikeId { get; set; }
    
    //create a callback parameter
    [Parameter]
    public EventCallback<AcknowledgementResponse> OnLike { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await InitData();
        await base.OnInitializedAsync();
    }

    private async Task InitData()
    {
        var query = new GetAcknowledgementLikeByLikerId.Query { LikerId = ProfileId, AcknowledgementId = AcknowledgementId };
        var result = await Sender.Send(query);
        if (result is { IsSuccess: true, Value: not null })
        {
            IsLiked = result.Value.AcknowledgmentId == AcknowledgementId;
            AcknowledgementLikeId = result.Value.Id;
        }
    }

    private async Task LikeAcknowledgement()
    {
        if (IsLiked)
        {
            var command = new UnlikeAcknowledgement.Command { AcknowledgementLikeId = AcknowledgementLikeId };
            var result = await Sender.Send(command);
            if (result.IsSuccess)
            {
                IsLiked = false;
                await OnLike.InvokeAsync(Acknowledgement);
            }
        }
        else
        {
            var command = new LikeAcknowledgement.Command { LikerId = ProfileId, AcknowledgementId = AcknowledgementId };
            var result = await Sender.Send(command);
            if (result.IsSuccess)
            {
                IsLiked = true;
                AcknowledgementLikeId = result.Value.Id;
                await OnLike.InvokeAsync(Acknowledgement);
            }
        }
    }

}

<FluentButton IconEnd="@(IsLiked ? new Icons.Filled.Size16.ThumbLike() : new Icons.Regular.Size16.ThumbLike())"
              Title="@(IsLiked ? "Unlike" : "Like")"
              OnClick="() => LikeAcknowledgement()" />
